{"version":3,"file":"public/javascripts/app.js","sources":["app/application.js","app/initialize.js","app/lib/router.js","app/lib/view_helper.js","app/models/collection.js","app/models/model.js","app/models/question.js","app/models/questions.js","app/models/vertex.js","app/models/vertices.js","app/views/about_view.js","app/views/home_view.js","app/views/play_view.js","app/views/questionEditView.js","app/views/question_view.js","app/views/questionsEditView.js","app/views/questions_view.js","app/views/templates/about.jade","app/views/templates/home.jade","app/views/templates/index.jade","app/views/templates/layout.jade","app/views/templates/play.jade","app/views/templates/question-edit.jade","app/views/templates/question.jade","app/views/templates/questions.jade","app/views/templates/vertex.jade","app/views/templates/vertices.jade","app/views/vertex_view.js","app/views/vertices_view.js","app/views/view.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/DA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AANA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApGA;;A,CCAA;;;;A,CCAA;;AACA;AACA;AACA;AACA;AAJA;;A,CCAA;;AACA;AACA;AACA;AACA;AAJA;;A,CCAA;;AACA;AACA;AACA;AAHA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAXA;;A,CCAA;;AACA;AACA;AACA;AAHA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7DA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnBA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAtCA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9GA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzKA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA5RA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzVA;;A,CCAA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnBA;;A","sourcesContent":["// Application bootstrapper.\nApplication = {\n  initialize: function() {\n\n    var NS = 'http://purl.net/net/socialmirror/';\n\n    var HomeView = require('views/home_view');\n    var AboutView = require('views/about_view');\n    var PlayView = require('views/play_view');\n\n    var Router = require('lib/router');\n\n    this.homeView = new HomeView();\n    this.aboutView = new AboutView();\n    this.playView = new PlayView();\n\n    this.router = new Router();\n    if (typeof Object.freeze === 'function') Object.freeze(this);\n  }\n}\n\nmodule.exports = Application;\n\n// $(document).bind('touchmove', function(e) {\n//    e.preventDefault();\n// }, false);\n\n// $(function(){\n//     // LISTEN FOR MESSAGES\n//     PUBNUB.subscribe({\n//         channel    : \"socialmirror\",     // CONNECT TO THIS CHANNEL.\n//         restore    : false,              // STAY CONNECTED, EVEN WHEN BROWSER IS CLOSED\n//                                          // OR WHEN PAGE CHANGES.\n//         callback   : function(message) { // RECEIVED A MESSAGE.\n//             console.log(message);\n//         },\n//         connect    : function() {        // CONNECTION ESTABLISHED.\n//             PUBNUB.publish({             // SEND A MESSAGE.\n//                 channel : \"socialmirror\",\n//                 message : \"HELLO \"\n//             })\n//         },\n//         disconnect : function() {        // LOST CONNECTION.\n//             console.log(\n//                 \"Connection Lost.\" +\n//                 \"Will auto-reconnect when Online.\"\n//             )\n//         },\n//         reconnect  : function() {        // CONNECTION RESTORED.\n//             console.log(\"And we're Back!\")\n//         },\n//         presence   : function(message) {\n//             console.log(message, true);\n//         }\n//     });    \n// });\n\n//window.PUB = function(message) {\n    // PUBNUB.publish({channel: \"socialmirror\", message: {\n    //     uuid: window.localStorage.getItem('sub-c-6dc73c52-5a8a-11e2-83f4-12313f022c90uuid'),\n    //     payload: message\n    // }});\n//}\n","var application = require('application');\n\n$(function() {\n  application.initialize();\n  Backbone.history.start();\n});\n","var application = require('application');\n\nmodule.exports = Backbone.Router.extend({\n  routes: {\n    '':       'home',\n    'questions':  'questions',\n    'play':   'play' \n  },\n\n  home: function() {\n    $('#viewport').html(application.homeView.render().el);\n  },\n\n  about: function() {\n    $('#viewport').html(application.aboutView.render().el);\n    \n  },\n\n  questions: function() {\n    $('#viewport').html(application.aboutView.render().el);\n\n    /////\n\n    // $('#editQuestions')\n\n    var Question = require('models/question');\n    var Questions = require('models/questions');\n    var QuestionEditView = require('views/question_view');\n    var QuestionsEditView = require('views/questions_view');\n\n    var questions = new Questions();\n\n    // questions.comparator = function(model) {\n    //     return model.get('sort');\n    // };\n    \n    var questionsEditView = new QuestionsEditView({\n      el: $('#editQuestions'),\n      collection: questions\n    });\n\n    $('#editQuestions').append(questionsEditView.render().el);\n\n    questions.fetch();\n\n\n\n\n    $( \"ol.answers\" ).sortable({\n      connectWith: \".answers\"\n    }).disableSelection();\n\n\n    $('ul.new form').bind('submit', function (event){\n      event.preventDefault();\n      var input = $(this).find('input');\n      //add to parent ...\n      input.val('');\n    });\n\n    $( \"ul.answers.delete\" ).sortable({\n      receive: function( event, ui ) {\n        // console.log(ui);\n        ui.item.remove();\n        //trigger collection remove\n      }\n    });\n\n    /////\n  },\n\n  play: function() {\n    $('#viewport').html(application.playView.render().el);\n\n    var Vertices = require('models/vertices');\n    var vertices = new Vertices();\n    window.vertices = vertices;\n\n    var VerticesView = require('views/vertices_view');\n    var verticesView = new VerticesView({collection: vertices});\n    \n    $('#play-view').append(verticesView.render().el);\n\n    vertices.fetch();\n\n    if (vertices.length == 0) {\n      //create user node\n      window.YOU = vertices.add({\n        name: 'YOU',\n        x: $('.vertices').width()/2 - 41,\n        y: $('.vertices').height() - 2*41 - $('.vertices').offset().top\n      }).at(0);\n\n      window.YOU.save();\n    } else {\n      window.YOU = vertices.at(0);\n    }\n  }\n\n});\n","","// Base class for all collections.\nmodule.exports = Backbone.Collection.extend({\n  \n});\n","// Base class for all models.\nmodule.exports = Backbone.Model.extend({\n  \n});\n","module.exports = Backbone.Model.extend({\n  \tidAttribute: \"_id\"\n});\n","var Question = require('models/question');\n\nmodule.exports = Backbone.Collection.extend({\n\tmodel: \tQuestion,\n\turl: \t'questions.json',\n\t// url: \t'http://socialmirror.namebound.net:3000/api/questions',\n\n\tinitialize: function() {\n\t\tconsole.log('init questions');\n\t}\n});\n","module.exports = Backbone.Model.extend({\n  \n});\n","var Vertex = require('models/vertex');\n\nmodule.exports = Backbone.Collection.extend({\n\tmodel: \tVertex,\n\turl: \t'vertices.json',\n\tlocalStorage: new Backbone.LocalStorage(\"Vertices\"),\n\n\tinitialize: function() {\n\t\tconsole.log('init vertices');\n\t\t_.extend(this, new Backbone.Memento(this));\n\t}\n});\n","var View = require('./view');\nvar template = require('./templates/about');\n\nmodule.exports = View.extend({\n  id: 'about-view',\n  template: template,\n\n  afterRender: function() {\n \t\n\n    return this;\n\n  }\n});\n","var View = require('./view');\nvar template = require('./templates/home');\n\nmodule.exports = View.extend({\n  id: 'home-view',\n  template: template,\n\n  afterRender: function() {\n  \t// console.log('home-view afterRender');\n\n    $('canvas').remove();\n\n  \t$(this.el).find('#clear').click(function() {\n  \t\t// var uuid = window.localStorage.getItem('sub-c-6dc73c52-5a8a-11e2-83f4-12313f022c90uuid');\n      // var backup = window.localStorage.getItem(\"backup\") + \" @@@ \" + JSON.stringify(vertices.toJSON());\n  \t\t\n      window.localStorage.clear();\n      window.localStorage.clear();\n\n  \t\t// window.localStorage.setItem('sub-c-6dc73c52-5a8a-11e2-83f4-12313f022c90uuid', uuid);\n      // window.localStorage.setItem(\"backup\", backup);\n  \t});\n  }\n});\n","var View = require('./view');\nvar template = require('./templates/play');\n\nvar Question = require('models/question');\nvar Questions = require('models/questions');\nvar QuestionView = require('./question_view');\nvar QuestionsView = require('./questions_view');\n\nmodule.exports = View.extend({\n  id: 'play-view',\n  template: template,\n\n  afterRender: function() {\n\n //  \tthis.question = new Question({\n\t// \"id\":\t\"http://purl.org/net/socialmirror/q/1\",\n\t// \"title\": \"What is your favourite colour?\",\n\t// \"type\": \"default\",\n\t// \"answers\": [\n\t// \t{\n\t// \t\t\"label\": \"blue\"\n\t// \t},\n\t// \t{\n\t// \t\t\"label\": \"black\"\n\t// \t},\n\t// \t{\n\t// \t\t\"label\": \"mauve\"\n\t// \t},\n\t// \t{\n\t// \t\t\"label\": \"teal\"\n\t// \t}\n\t// ]\n\t// });\n\n //  \tthis.questionView = new QuestionView({\n //  \t\tel: this.$('.questionBlock'),\n //  \t\tmodel: this.question\n //  \t}).render();\n\n  \t//\n\n  \tvar questions = new Questions();\n  \tvar questionsView = new QuestionsView({\n  \t\tel: this.$('.questions'),\n  \t\tcollection: questions\n  \t});\n\n  \t$('.questions').append(questionsView.render().el);\n\n  \tquestions.fetch();\n\n\n  \twindow.saveDATA = function () {\n  \t\t$('#entry_0').val(JSON.stringify(vertices.toJSON()));\n  \t\t$('#entry_1').val(window.localStorage.getItem(\"backup\"));\n  \t\t$('#submit').trigger('click');\n  \t}\n\n\n  }\n});\n","var View = require('./view');\nvar template = require('./templates/question-edit');\n\nmodule.exports = View.extend({\n  className: 'editQuestion',\n  template: template,\n\n  initialize: function() {\n    console.log('init questionEditView');\n  \t_.bindAll(this, 'render');\n  \tthis.model.bind('change', this.render);\n  },\n\n  render: function() {\n  \tthis.$el.html(this.template(this.model.toJSON()));  \t\n  \treturn this;\n  }\n\n});\n","var View = require('./view');\nvar template = require('./templates/question');\n\nmodule.exports = View.extend({\n  className: 'question',\n  template: template,\n\n  initialize: function() {\n    console.log('init questionView');\n  \t_.bindAll(this, 'render');\n  \tthis.model.bind('change', this.render);\n  },\n\n  render: function() {\n  \tthis.$el.html(this.template(this.model.toJSON()));  \t\n  \treturn this;\n  }\n\n});\n","var View = require('./view');\nvar template = require('./templates/questions');\n\nvar Question = require('models/question');\nvar QuestionEditView = require('views/questionEditView');\n\nmodule.exports = View.extend({\n  className: 'editQuestions',\n  template: template,\n\n  initialize: function() {\n    console.log('init questionsEditView');\n  \t_.bindAll(this, 'render');\n    this.collection.bind('reset', this.render);\n  },\n\n  render: function() {\n  \tvar $questions,\n  \t\tcollection = this.collection;\n\n  \t$(this.el).html(this.template({}));\n  \t$questions = $(this.el);//this.$('.questions');\n\n  \tcollection.each(function (question) {\n  \t\tvar view = new QuestionEditView({\n  \t\t\tmodel: question,\n  \t\t\tcollection: collection\n  \t\t});\n  \t\t$questions.append(view.render().el);\n  \t});\n\n  \t\n\n  \treturn this;\n  }\n\n  \n});\n","var View = require('./view');\nvar template = require('./templates/questions');\n\nvar Question = require('models/question');\nvar QuestionView = require('views/question_view');\n\nmodule.exports = View.extend({\n  className: 'questions',\n  template: template,\n  current: 0,\n\n  initialize: function() {\n    console.log('init questionsView');\n  \t_.bindAll(this, 'render');\n    this.collection.bind('reset', this.render);\n  },\n\n  render: function() {\n  \tvar $questions,\n  \t\tcollection = this.collection;\n\n      collection.comparator = function(model) {\n        return parseInt(model.get('sort'));\n      };\n\n      collection.sort();\n\n  \t$(this.el).html(this.template({}));\n  \t$questions = $(this.el);//this.$('.questions');\n\n  \tcollection.each(function (question) {\n  \t\tvar view = new QuestionView({\n  \t\t\tmodel: question,\n  \t\t\tcollection: collection\n  \t\t});\n      if (question.get('type') != 'skip') {\n  \t\t  $questions.find('.questionBlock').append(view.render().el);\n      }\n  \t});\n\n  \t$( \".question .vertex\" ).draggable({\n      revert: \"invalid\",\n      helper: \"clone\"\n    });\n\n\n    $( \".question input\" ).each(function(i, q) {\n      if (window.YOU.get($(q).attr('name')) != null) $(q).val(window.YOU.get($(q).attr('name')));\n    });\n\n    $( \".question select\" ).each(function(i, q) {\n      if (window.YOU.get($(q).attr('name')) != null) $(q).val(window.YOU.get($(q).attr('name')));\n    });\n\n    $( \".question input\" ).bind('blur change', function() {\n      window.YOU.set($(this).attr('name'), $(this).val());\n      window.YOU.save();\n    });\n\n    $( \".question select\" ).bind('blur change', function() {\n      window.YOU.set($(this).attr('name'), $(this).val());\n      window.YOU.save();\n    });\n\n  \t$('#END').click(function() {\n  \t   window.saveDATA();\n  \t   \n  \t});\n\n    this.show(0);\n\n  \treturn this;\n  },\n\n  events: {\n  \t'click #prev': 'previous',\n  \t'click #next': 'next'\n  },\n\n  show: function(index) {\n  \t\n  \tif (index == 28 || index < 0  ) { \n  \t    alert('end!');\n  \t    var email_address = $(\"input[name='5110eb6a5f68617249000005-email']\").val();\n  \t    $.get('http://jimmytidey.co.uk/mailer.php?email_address=' + email_address); //JT HACK TO SEND MAIL\n  \t    \n  \t}\n  \t\n  \t\n  \t$($(this.el).find('.question').hide().get(index)).show();\n  \t// todo toggle question\n  \tif (this.collection.at(index) != null) {\n  \t\twindow.questionID = this.collection.at(index).get('_id');\n  \t} else {\n  \t\twindow.questionID = \"NIL\";\n  \t}\n  \tif (typeof vertices != 'undefined') vertices.reset(vertices.models);;\n\n\n  },\n\n  previous: function() {\n  \tthis.show(--this.current);\n  },\n\n  next: function() {\n  \tthis.show(++this.current);\n  }\n\n});\n","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"masthead\"><ul class=\"nav nav-pills pull-right\"><li><a href=\"#\">Home</a></li><li class=\"active\"><a href=\"#questions\">Questions</a></li><li><a href=\"#\" class=\"muted\">Contact</a></li></ul><h3 class=\"muted\">Social Mirror</h3></div><hr/><h1>Questions</h1><div id=\"editQuestions\"></div><div class=\"editQuestions\"><div class=\"editQuestion\"><h3><span>Title  </span></h3><p class=\"muted\">Lorem ipsum</p><ol class=\"answers\"><li>name</li><li>name</li><li>name</li></ol><ul class=\"answers delete\"><li class=\"muted\"> <em>drag here to delete</em></li></ul><ul class=\"new\"><li> <form><input placeholder=\"add new\"/></form></li></ul></div></div><button class=\"btn btn-primary disabled\">Publish Questions</button><hr/><footer><p class=\"muted\">&copy; 2012 <a href=\"\" target=\"_new\">Social Mirror</a>, all rights reserved.</p></footer>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"masthead\"><ul class=\"nav nav-pills pull-right\"><li class=\"active\"><a href=\"#\">Home</a></li><li><a href=\"#questions\">Questions</a></li><li><a href=\"#\" class=\"muted\">Contact</a></li></ul><h3>Social Mirror</h3></div><hr/><div class=\"jumbotron\"><!--h1 Social Mirror--><p class=\"lead\">Social networks — who you know and are connected to — are understood to reach into all areas of life, yet very few people or organisations are capable of drawing insights from network information.</p><p>Social Mirror is a tablet application that you can use to measure, visualise, and see the potential for change in online and offline networks. Starting in January 2012, we developed a prototype for use by social science researchers.</p><p>More recently, having been approved for funding by the <a href=\"http://www.nominettrust.org.uk/\" target=\"_new\">Nominet Trust</a>, we are exploring its practical use in public services. We will soon be demoing the Social Mirror app on-line: <a href=\"http://socialmirror.org.uk/learn-more/\" target=\"_new\">please sign up here </a>if you would like to be informed when this happens.</p><div class=\"center\"><a id=\"clear\" href=\"#play\" class=\"round btn btn-large btn-primary\"><span>NEW SURVEY</span></a></div><hr/><div class=\"center\"><a href=\"#play\" class=\"btn btn-large btn-primary\"><span>RESUME SURVEY</span></a></div></div><hr/><footer><p class=\"muted\">&copy; 2012 <a href=\"\" target=\"_new\">Social Mirror</a>, all rights reserved.</p></footer>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div id=\"content\"><h1>brunch</h1></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<!DOCTYPE html><html lang=\"en\" class=\"no-js\"><head><meta charset=\"utf-8\"><meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge,chrome=1\"><title>UI</title><link rel=\"stylesheet\" href=\"/stylesheets/app.css\"><script src=\"javascripts/vendor.js\"></script><script src=\"javascripts/app.js\"></script><script>require(\\'initialize\\');</script><link rel=\"apple-touch-icon-precomposed\" sizes=\"144x144\" href=\"apple-touch-icon-144x144-precomposed.png\"><link rel=\"apple-touch-icon-precomposed\" sizes=\"114x114\" href=\"apple-touch-icon-114x114-precomposed.png\"><link rel=\"apple-touch-icon-precomposed\" sizes=\"72x72\" href=\"apple-touch-icon-72x72-precomposed.png\"><link rel=\"apple-touch-icon-precomposed\" href=\"apple-touch-icon-57x57-precomposed.png\"><link rel=\"shortcut icon\" href=\"favicon.ico\"></head><body><script>var _gaq=[[\\'_setAccount\\',\\'UA-XXXXX-X\\'],[\\'_trackPageview\\']];\\n(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];\\ng.src=(\\'https:\\'==location.protocol?\\'//ssl\\':\\'//www\\')+\\'.google-analytics.com/ga.js\\';\\ns.parentNode.insertBefore(g,s)}(document,\\'script\\'));</script></body></html>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"questions\"></div><div class=\"menu\"><a id=\"undo\" class=\"disabled btn pull-left\"><i class=\"icon-undo\"></i></a><a href=\"#\" id=\"del\" class=\"btn pull-right\"><i class=\"icon-info-sign\"></i></a></div><div id=\"you-wrapper\" class=\"row-fluid\"><div class=\"span6\"><div id=\"you\" class=\"round btn\"><h1>YOU</h1></div></div></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<h3><span>Title  </span></h3><p class=\"muted\">Lorem ipsum</p><ol class=\"answers\"><li>name</li><li>name</li><li>name</li></ol><ul class=\"answers delete\"><li class=\"muted\"> <em>drag here to delete</em></li></ul><ul class=\"new\"><li> <form><input placeholder=\"add new\"/></form></li></ul>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div class=\"center\"><h1><span class=\"muted\">Q: </span><span>' + escape((interp = title) == null ? '' : interp) + '</span></h1><p class=\"muted\">' + escape((interp = desc) == null ? '' : interp) + '</p>');\nif ( type == 'graph')\n{\n// iterate answers\n;(function(){\n  if ('number' == typeof answers.length) {\n\n    for (var $index = 0, $$l = answers.length; $index < $$l; $index++) {\n      var item = answers[$index];\n\nbuf.push('<div class=\"vertex blue\"><span>');\nvar __val__ = item.label\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span></div>');\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in answers) {\n      $$l++;      var item = answers[$index];\n\nbuf.push('<div class=\"vertex blue\"><span>');\nvar __val__ = item.label\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span></div>');\n    }\n\n  }\n}).call(this);\n\n}\nif ( type == 'text')\n{\n// iterate answers\n;(function(){\n  if ('number' == typeof answers.length) {\n\n    for (var $index = 0, $$l = answers.length; $index < $$l; $index++) {\n      var item = answers[$index];\n\nbuf.push('<input');\nbuf.push(attrs({ 'name':(_id + '-' + item.value), 'placeholder':(item.label) }, {\"name\":true,\"placeholder\":true}));\nbuf.push('/>');\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in answers) {\n      $$l++;      var item = answers[$index];\n\nbuf.push('<input');\nbuf.push(attrs({ 'name':(_id + '-' + item.value), 'placeholder':(item.label) }, {\"name\":true,\"placeholder\":true}));\nbuf.push('/>');\n    }\n\n  }\n}).call(this);\n\n}\nif (  type == 'select')\n{\nbuf.push('<select');\nbuf.push(attrs({ 'name':(_id) }, {\"name\":true}));\nbuf.push('><option value=\"\">');\nvar __val__ = \"please select\"\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option>');\n// iterate answers\n;(function(){\n  if ('number' == typeof answers.length) {\n\n    for (var $index = 0, $$l = answers.length; $index < $$l; $index++) {\n      var option = answers[$index];\n\nbuf.push('<option');\nbuf.push(attrs({ 'value':(option.value) }, {\"value\":true}));\nbuf.push('>');\nvar __val__ = option.label\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option>');\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in answers) {\n      $$l++;      var option = answers[$index];\n\nbuf.push('<option');\nbuf.push(attrs({ 'value':(option.value) }, {\"value\":true}));\nbuf.push('>');\nvar __val__ = option.label\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option>');\n    }\n\n  }\n}).call(this);\n\nbuf.push('</select>');\n}\nif (  type == 'stars')\n{\nbuf.push('<select');\nbuf.push(attrs({ 'name':(_id) }, {\"name\":true}));\nbuf.push('><option value=\"1\">');\nvar __val__ = \"★\"\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option><option value=\"2\">');\nvar __val__ = \"★★\"\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option><option value=\"3\">');\nvar __val__ = \"★★★\"\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option><option value=\"4\">');\nvar __val__ = \"★★★★\"\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option><option value=\"5\">');\nvar __val__ = \"★★★★★\"\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option></select>');\n}\nif (  type == '10stars')\n{\nbuf.push('<select');\nbuf.push(attrs({ 'name':(_id) }, {\"name\":true}));\nbuf.push('><option value=\"1\">');\nvar __val__ = \"★\"\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option><option value=\"2\">');\nvar __val__ = \"★★\"\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option><option value=\"3\">');\nvar __val__ = \"★★★\"\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option><option value=\"4\">');\nvar __val__ = \"★★★★\"\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option><option value=\"5\">');\nvar __val__ = \"★★★★★\"\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option><option value=\"6\">');\nvar __val__ = \"★★★★★★\"\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option><option value=\"7\">');\nvar __val__ = \"★★★★★★★\"\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option><option value=\"8\">');\nvar __val__ = \"★★★★★★★★\"\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option><option value=\"9\">');\nvar __val__ = \"★★★★★★★★★\"\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option><option value=\"10\">');\nvar __val__ = \"★★★★★★★★★★\"\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</option></select>');\n}\nif ( title == 'Thank you!')\n{\nbuf.push('<a id=\"END\" class=\"btn\">SUBMIT DATA</a>');\n}\nbuf.push('</div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<a id=\"prev\" class=\"btn btn-large pull-left\"><i class=\"icon-circle-arrow-left\"></i></a><a id=\"next\" class=\"btn btn-large pull-right\"><i class=\"icon-circle-arrow-right\"></i></a><div class=\"questionBlock\"></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<span>' + escape((interp = name) == null ? '' : interp) + '</span>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\n}\nreturn buf.join(\"\");\n};","var View = require('./view');\nvar template = require('./templates/vertex');\n\nmodule.exports = View.extend({\n  className: 'vertex',\n  template: template,\n\n  initialize: function() {\n    console.log('init vertexView');\n  \t_.bindAll(this, 'render');\n  \tthis.model.bind('change', this.render);\n    this.model.bind('edit', this.edit);\n    this.model.bind('activate', this.activate);\n    this.model.bind('deactivate', this.deactivate);\n  },\n\n  render: function() {\n  \tvar renderedContent = this.template(this.model.toJSON());\n  \tconsole.log('render vertex');\n    var self = this;\n\n    if (window.questionID != '51119351416b86696a000002'){\n\n  \t$(this.el)\n      .data('model', this.model)\n  \t\t.html(renderedContent)\n  \t\t.css({\n  \t\t\ttop: this.model.get('y') + \"px\",\n  \t\t\tleft: this.model.get('x') + \"px\"\n  \t\t}).draggable({   \n        start: function() {\n          // console.log('0');\n          // window.vertices.store();\n        },\n        drag: function() {\n          // console.log('1');\n        },\n        stop: function() {\n          // console.log('2');\n        }\n      })\n      .hammer({\n        prevent_default: true,\n        drag: false,\n        tap: false,\n\n      }).popover({\n        placement: 'top',\n        title: function() {\n          return self.model.get('name');\n        },\n        trigger: 'manual',\n        html: true,\n        content: function() {\n\n          var $buttons = $('<div></div>');\n          $('<button class=\"btn edit\" style=\"display: none\">Rename</button>')\n              .data('model', self.model)\n              .data('view', self)\n              .appendTo($buttons);\n\n          // $('<button class=\"btn select\" data-toggle=\"button\">Answer</button>')\n          //     .data('model', self.model)\n          //     .data('view', self)\n          //     .appendTo($buttons);\n\n          var $group = $('<div class=\"btn-group\" data-toggle=\"buttons-radio\"></div>')\n            .appendTo($buttons);\n\n\n          var active = '';\n          var nactive = 'active';\n          if (self.model.get(window.questionID) == 1) {\n            active = 'active';\n            nactive = '';\n          }\n\n          $('<button class=\"btn select0 '+nactive+'\">Not an Answer</button>')\n              .data('model', self.model)\n              .data('view', self)\n              .appendTo($group);\n\n          \n\n          $('<button class=\"btn select1 '+active+'\">An Answer</button>')\n              .data('model', self.model)\n              .data('view', self)\n              .appendTo($group);\n\n\n              /*<div class=\"btn-group\" data-toggle=\"buttons-checkbox\">\n  <button type=\"button\" class=\"btn btn-primary\">Left</button>\n  <button type=\"button\" class=\"btn btn-primary\">Middle</button>\n  <button type=\"button\" class=\"btn btn-primary\">Right</button>\n</div>*/\n          return $buttons;\n        }\n      });\n    } else {\n      //CONN\n      $(this.el)\n      .data('model', this.model)\n      .html(renderedContent)\n      .css({\n        top: this.model.get('y') + \"px\",\n        left: this.model.get('x') + \"px\"\n      }).draggable({   \n        start: function() {\n          // console.log('0');\n          // window.vertices.store();\n        },\n        drag: function() {\n          // console.log('1');\n        },\n        stop: function() {\n          // console.log('2');\n        },\n        revert: \"invalid\",\n        helper: \"clone\"\n      })\n      .hammer({\n        prevent_default: true,\n        drag: false,\n        tap: false,\n\n      }).droppable({\n        accept: '.vertex',\n        hoverClass: \"ui-state-active\",\n        drop: function( event, ui ) {\n          // self.model;\n          var model = ui.draggable.data('model');\n          var connections = model.get('connections');\n          if (connections == null) connections = [];\n\n          if (_.contains(connections, self.model.get('id'))) {\n\n            model.set('connections', _.without(connections, self.model.get('id')));\n            model.save();\n            reconnectNodes(true);\n\n          } else if (self.model.get('connections') != null && _.contains(self.model.get('connections'), model.get('id'))) {\n            self.model.set('connections', _.without(self.model.get('connections'), model.get('id')));\n            self.model.save();\n            reconnectNodes(true);\n\n          } else {\n            connections.push(self.model.get('id'));\n\n            // window.connectNodes(model, self.model);\n\n            model.set('connections', connections);\n            model.save();\n\n            reconnectNodes(true);\n          }\n          \n        }\n      });\n\n    }\n\n    if (this.model.get(window.questionID) == 1) {\n      $(this.el).addClass('answer');\n    };\n    if (this.model.get('deleted') == 1) {\n      $(this.el).addClass('deleted');\n    };\n\n  \treturn this;\n  },\n\n  events: {\n    // 'hold': 'menu',\n    // 'click': 'select',\n    'drag': 'drag',\n    // 'dblclick': 'edit',\n    'doubletap': 'menu'\n\n  },\n\n  answer: function() {\n    if (window.questionID == '51119351416b86696a000002') return;\n  \t// this.collection.trigger('select', this.model);\n  \t$(this.el).toggleClass('answer');\n    // this.mode\n    if ($(this.el).hasClass('answer')) {\n      this.model.set(window.questionID, 1,  {silent: true});\n    } else {\n      this.model.set(window.questionID, 0,  {silent: true});\n    }\n    this.model.save(null, { silent: true });\n  },\n\n  activate: function(event) {\n\n    var view = $(event.currentTarget).data('view');\n    var model = $(event.currentTarget).data('view').model;\n\n    // console.log(view.el);\n\n    $(view.el).addClass('answer');\n      model.set(window.questionID, 1,  {silent: true});\n      model.save(null, { silent: true });\n  },\n\n  deactivate: function(event) {\n    var view = $(event.currentTarget).data('view');\n    var model = $(event.currentTarget).data('view').model;\n\n    // console.log(view.el);\n\n    $(view.el).removeClass('answer');\n      model.set(window.questionID, 0,  {silent: true});\n      model.save(null, { silent: true });\n  },\n\n  select: function() {\n    this.collection.trigger('select', this.model);\n    $(this.el).toggleClass('selected');\n  },\n\n  drag: function(event, ui) {\n    if (window.questionID != '51119351416b86696a000002') {\n  \t this.model.set('x', ui.position.left, {silent: true});\n  \t this.model.set('y', ui.position.top, {silent: true});\n\n     reconnectNodes(true);\n    }\n    $(this.el).popover('hide');\n  },\n\n  delete: function() {\n    console.log(this.model);\n    // window.model = this.model;\n    // vertices.collection.remove(this.model);\n  },\n\n  menu: function() {\n    $('.vertices .vertex').not(this.el).popover('hide');\n    $(this.el).popover('show');\n  },\n\n  edit: function(event) {\n\n    console.log(event);\n  \n    \n    if (event) event.preventDefault();\n    if (window.questionID == '51119351416b86696a000002') return;\n    \n   \n    console.log(this);\n    \n    console.log($(event.currentTarget).data('view'));\n\n    var model = $(event.currentTarget).data('view').model;\n    var $span = $(event.currentTarget).data('view').$('span');\n\n    var $span = $(event.currentTarget).parents('.popover').find('h3');\n\n\n    var $el = $($(event.currentTarget).data('view').el);//.popover('destroy');\n\n\n    // $($(event.currentTarget).data('view').el).popover('destroy');\n    \n\n    var $input = $('<input>')\n      .val(model.get('name'));\n\n    $span.html($input);\n    $input.bind('blur change', function() {\n      // PUB({\n      //   action: 'rename',\n      //   id: model.get('id'),\n      //   from: model.get('name'),\n      //   value: $(this).val()\n      // });\n      model.set('name', $(this).val());\n      $el.popover('hide');\n    })\n    .trigger('focus');\n  }\n});\n","var View = require('./view');\nvar template = require('./templates/vertices');\n\nvar VertexView = require('views/vertex_view');\n\nmodule.exports = View.extend({\n  className: 'vertices',\n  template: template,\n\n  initialize: function() {\n    console.log('init verticesView');\n  \t_.bindAll(this, 'render');\n    this.collection.bind('reset', this.render);\n    this.collection.bind('add', this.render);\n  \tthis.collection.bind('select', this.select);\n  },\n\n  render: function() {\n    // console.log('vertices render');\n  \tvar $vertices,\n  \t\tcollection = this.collection;\n\n  \t$(this.el).html(this.template({}));\n  \t$vertices = $(this.el);//this.$('.vertices');\n\n    \n\n  \t$vertices.droppable({\n      accept: '.vertex',\n      hoverClass: \"ui-state-active\",\n      drop: function( event, ui ) {\n        // console.log(event, ui, ui.draggable.data('model'));\n        if (ui.draggable.parent().hasClass('vertices')) {\n          var model = ui.draggable.data('model');\n          model.save();\n\n          // PUB({\n          //   action: 'move',\n          //   id: model.get('id'),\n          //   name: model.get('name'),\n          //   x: model.get('x'),\n          //   y: model.get('y')\n          // });\n\n        } else {\n          var model = collection.create({\n        \t\tname: ui.draggable.text(),\n            x: $(ui.helper).offset().left - $('.vertices').offset().left,\n            y: $(ui.helper).offset().top - $('.vertices').offset().top\n        \t});\n\n          model.set('created', window.questionID);\n          model.set(window.questionID, 1);\n          model.set('proto', model.get('name'));\n\n          // model.trigger('hold');\n\n          // PUB({\n          //   action: 'create',\n          //   id: model.get('id'),\n          //   name: model.get('name'),\n          //   x: model.get('x'),\n          //   y: model.get('y')\n          // });\n\n        }\n        // collection.reset(collection.models);\n        collection.store();\n        reconnectNodes();\n\n        // draw\n        // this.ctx.fillStyle = \"rgb(150,29,28)\";\n\n      }\n    }).hammer({\n        prevent_default: true,\n        // drag: false\n    });\n\n    $('.question h1').droppable({\n      accept: '.vertex',\n      hoverClass: \"ui-state-active\",\n      drop: function( event, ui ) {\n        if (window.questionID == '51119351416b86696a000002') return;\n        // console.log(event, ui, ui.draggable.data('model'));\n        if (ui.draggable.parent().hasClass('vertices')) {\n          var model = ui.draggable.data('model');\n          model.set('deleted', 1);\n          ui.draggable.addClass('deleted');\n          model.save();\n\n          PUB({\n            action: 'delete',\n            id: model.get('id'),\n            name: model.get('name')\n          });\n\n        }\n        // collection.reset(collection.models);\n        collection.store();\n      }\n    });\n\n    if (window.questionID != '51119351416b86696a000002'){\n      $vertices.droppable( \"enable\" );\n    } else {\n      //CONN\n      $vertices.droppable( \"disable\" );\n    }\n\n\n    var $canvas;\n\n    function makeCanvas() {\n    $canvas = $('canvas');\n    // $canvas.remove();\n    //canvas\n    // if (window.ctx == null) {\n      // $('<canvas>').remove();\n      if ($canvas.size() == 0) {\n\n        $canvas = $('<canvas>')\n          .attr('width', $('body').width())\n          .attr('height', $('body').height());\n      \n        \n        // $('#play-view').append($canvas);\n        $('body').append($canvas);\n\n        // $canvas = $('<canvas>')\n        // .attr('width', $vertices.width())\n        // .attr('height', $vertices.height());\n\n        // $vertices.append($canvas);\n\n        window.ctx = $canvas.get(0).getContext('2d');\n      }\n      // window.ctx = $canvas.get(0).getContext('2d');\n      // if (typeof window.ctx == 'undefined') window.ctx = $canvas.get(0).getContext('2d');\n\n      window.ctx.lineWidth = 1;  \n    // }\n\n    // var self = this;\n\n    // window.ctx = this.ctx;\n    }\n    makeCanvas();\n\n    window.connectNodes = function(from, to) {\n      // window.ctx.closePath();\n\n      window.ctx.lineWidth = 1; \n      window.ctx.strokeStyle = \"rgb(255, 0, 0)\";\n      window.ctx.beginPath();\n      window.ctx.moveTo(from.get('x') + 41 , from.get('y') + 41 );\n      window.ctx.lineTo(to.get('x') + 41 , to.get('y') + 41 );\n      window.ctx.stroke();\n      window.ctx.closePath();\n    };\n\n    window.clearCanvas = function() {\n      console.log('clearCanvas');\n\n      makeCanvas();\n      window.ctx.fillStyle = \"rgb(255, 255, 255)\";\n      // window.ctx.clearRect(0,0,parseInt($canvas.width()),parseInt($canvas.height()));\n      window.ctx.fillRect(0,0,parseInt($canvas.width()),parseInt($canvas.height()));\n\n      window.ctx.lineWidth = .5; \n      window.ctx.strokeStyle = \"rgb(128, 128, 128)\";\n\n      window.ctx.beginPath();\n      window.ctx.moveTo(0 , 400);\n      window.ctx.lineTo(parseInt($canvas.width()) , 400);\n      window.ctx.stroke();\n      window.ctx.closePath();\n\n      window.ctx.beginPath();\n      window.ctx.moveTo(0 , 250);\n      window.ctx.lineTo(parseInt($canvas.width()) , 250);\n      window.ctx.stroke();\n      window.ctx.closePath();\n\n      window.ctx.beginPath();\n      window.ctx.moveTo(0 , 175);\n      window.ctx.lineTo(parseInt($canvas.width()) , 175);\n      window.ctx.stroke();\n      window.ctx.closePath();\n\n      window.ctx.beginPath();\n      window.ctx.moveTo(0 , 125);\n      window.ctx.lineTo(parseInt($canvas.width()) , 125);\n      window.ctx.stroke();\n      window.ctx.closePath();\n\n      // window.ctx = null;\n      // $('<canvas>').remove();\n\n      // $canvas = $('<canvas>')\n      //   .attr('width', $vertices.width())\n      //   .attr('height', $vertices.height());\n\n      // $vertices.append($canvas);\n\n      // window.ctx = $canvas.get(0).getContext('2d');\n      // window.ctx.lineWidth = 1;  \n    }\n\n    window.reconnectNodes = function(clear) {\n      // window.ctx.clearRect(0,0,$canvas.width(),$canvas.height());\n      // if (clear) \n        clearCanvas();\n\n      // if (window.questionID != '51115011214cb6ad39000001') return;\n\n      // console.log(\"connections\");\n      \n      // setTimeout(function(){\n\n      vertices.each(function (vertex) {\n       // console.log(vertex);\n      \n      var connections = vertex.get('connections');\n      if (connections != null) {\n\n        for (i = 0; i < connections.length; i++) {\n          connectNodes(vertex, collection.get(connections[i]));\n        }\n      } \n     });\n  // }, 200);\n\n    }\n    //\n\n\n  \tcollection.each(function (vertex) {\n  \t\tvar view = new VertexView({\n  \t\t\tmodel: vertex,\n  \t\t\tcollection: collection\n  \t\t});\n  \t\t$vertices.append(view.render().el);\n\n      //\n      // var connections = vertex.get('connections');\n      // if (connections != null) {\n      //   for (i = 0; i < connections.length; i++) {\n      //     connectNodes(vertex, collection.get(connections[i]));\n      //   }\n      // } \n      //\n  \t});\n\n    $('#undo').click(function() {\n      // collection.restore();\n    });\n\n    reconnectNodes(true);\n    \n\n\n  \treturn this;\n  },\n\n  events: {\n    // swipe: 'swipe',\n    // drag: 'drag',\n    // dragstart: 'dragstart',\n    // dragend: 'dragend'\n    'click .edit': 'edit',\n    'click .popover-title': 'edit2',\n    'click .select0': 'deactivate',\n    'click .select1': 'activate'\n  },\n\n  activate: function (event) {\n    $(event.currentTarget).data('model').trigger('activate', event);\n  },\n\n  deactivate: function (event) {\n    $(event.currentTarget).data('model').trigger('deactivate', event);\n  },\n\n  edit2: function (event) {\n    console.log('edit2');\n    $(event.currentTarget).parents('.popover').find('.edit').trigger('click');\n  },\n\n  edit: function (event) {\n    // console.log($(event.currentTarget).data('model'));\n    $(event.currentTarget).data('model').trigger('edit', event);\n  },\n\n  select: function(selectedModel) {\n  \t$('.vertices .selected').removeClass('selected');\n  },\n\n  swipe: function(e) {\n    console.log(e);\n  },\n\n  dragstart: function(event) {\n    // console.log(event); \n    // window._line = {};\n    // if (event.direction) {\n    //   this.ctx.strokeStyle = \"rgb(255, 0, 0)\";\n    //   this.ctx.beginPath();\n    //   this.ctx.moveTo(event.position.x, event.position.y);\n    //   this._line.x = event.position.x;\n    //   this._line.y = event.position.y;\n    // }\n  },\n\n  dragend: function(event) {\n    console.log(event); \n    // if (event.direction) {\n    //   this.ctx.closePath();\n\n    //   this.ctx.strokeStyle = \"rgb(0, 0, 0)\";\n    //   this.ctx.beginPath();\n    //   this.ctx.moveTo(window._line.x, window._line.y);\n    //   this.ctx.lineTo(window._line.x1, window._line.y1);\n    //   this.ctx.stroke();\n    //   this.ctx.closePath();\n    // } \n  },\n\n  drag: function(event) {\n    if (event.direction) {\n          // console.log(event); \n          // console.log(this.ctx);  \n\n          \n          \n          // this.ctx.lineTo(event.position.x + event.distanceX, event.position.y + event.distanceY);\n          // this.ctx.lineTo(event.position.x + 1, event.position.y + 1);\n          // this.ctx.lineTo(event.position.x, event.position.y);\n          // this.ctx.stroke();\n          // this._line.x1 = event.position.x;\n          // this._line.y1 = event.position.y;\n    }\n\n  }\n});\n","require('lib/view_helper');\n\n// Base class for all views.\nmodule.exports = Backbone.View.extend({\n  initialize: function() {\n    this.render = _.bind(this.render, this);\n  },\n\n  template: function() {},\n  getRenderData: function() {},\n\n  render: function() {\n    this.$el.html(this.template(this.getRenderData()));\n    this.afterRender();\n    return this;\n  },\n\n  afterRender: function() {}\n});\n"]}