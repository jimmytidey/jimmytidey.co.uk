(function(){"use strict";var e=typeof window!="undefined"?window:global;if(typeof e.require=="function")return;var t={},n={},r=function(e,t){return{}.hasOwnProperty.call(e,t)},i=function(e,t){var n=[],r,i;/^\.\.?(\/|$)/.test(t)?r=[e,t].join("/").split("/"):r=t.split("/");for(var s=0,o=r.length;s<o;s++)i=r[s],i===".."?n.pop():i!=="."&&i!==""&&n.push(i);return n.join("/")},s=function(e){return e.split("/").slice(0,-1).join("/")},o=function(t){return function(n){var r=s(t),o=i(r,n);return e.require(o,t)}},u=function(e,t){var r={id:e,exports:{}};t(r.exports,o(e),r);var i=n[e]=r.exports;return i},a=function(e,s){var o=i(e,".");s==null&&(s="/");if(r(n,o))return n[o];if(r(t,o))return u(o,t[o]);var a=i(o,"./index");if(r(n,a))return n[a];if(r(t,a))return u(a,t[a]);throw new Error('Cannot find module "'+e+'" from '+'"'+s+'"')},f=function(e,n){if(typeof e=="object")for(var i in e)r(e,i)&&(t[i]=e[i]);else t[e]=n},l=function(){var e=[];for(var n in t)r(t,n)&&e.push(n);return e};e.require=a,e.require.define=f,e.require.register=f,e.require.list=l,e.require.brunch=!0})(),require.register("application",function(e,t,n){Application={initialize:function(){var e="http://purl.net/net/socialmirror/",n=t("views/home_view"),r=t("views/about_view"),i=t("views/play_view"),s=t("lib/router");this.homeView=new n,this.aboutView=new r,this.playView=new i,this.router=new s,typeof Object.freeze=="function"&&Object.freeze(this)}},n.exports=Application}),require.register("initialize",function(e,t,n){var r=t("application");$(function(){r.initialize(),Backbone.history.start()})}),require.register("lib/router",function(e,t,n){var r=t("application");n.exports=Backbone.Router.extend({routes:{"":"home",questions:"questions",play:"play"},home:function(){$("#viewport").html(r.homeView.render().el)},about:function(){$("#viewport").html(r.aboutView.render().el)},questions:function(){$("#viewport").html(r.aboutView.render().el);var e=t("models/question"),n=t("models/questions"),i=t("views/question_view"),s=t("views/questions_view"),o=new n,u=new s({el:$("#editQuestions"),collection:o});$("#editQuestions").append(u.render().el),o.fetch(),$("ol.answers").sortable({connectWith:".answers"}).disableSelection(),$("ul.new form").bind("submit",function(e){e.preventDefault();var t=$(this).find("input");t.val("")}),$("ul.answers.delete").sortable({receive:function(e,t){t.item.remove()}})},play:function(){$("#viewport").html(r.playView.render().el);var e=t("models/vertices"),n=new e;window.vertices=n;var i=t("views/vertices_view"),s=new i({collection:n});$("#play-view").append(s.render().el),n.fetch(),n.length==0?(window.YOU=n.add({name:"YOU",x:$(".vertices").width()/2-41,y:$(".vertices").height()-82-$(".vertices").offset().top}).at(0),window.YOU.save()):window.YOU=n.at(0)}})}),require.register("lib/view_helper",function(e,t,n){}),require.register("models/collection",function(e,t,n){n.exports=Backbone.Collection.extend({})}),require.register("models/model",function(e,t,n){n.exports=Backbone.Model.extend({})}),require.register("models/question",function(e,t,n){n.exports=Backbone.Model.extend({idAttribute:"_id"})}),require.register("models/questions",function(e,t,n){var r=t("models/question");n.exports=Backbone.Collection.extend({model:r,url:"questions.json",initialize:function(){console.log("init questions")}})}),require.register("models/vertex",function(e,t,n){n.exports=Backbone.Model.extend({})}),require.register("models/vertices",function(e,t,n){var r=t("models/vertex");n.exports=Backbone.Collection.extend({model:r,url:"vertices.json",localStorage:new Backbone.LocalStorage("Vertices"),initialize:function(){console.log("init vertices"),_.extend(this,new Backbone.Memento(this))}})}),require.register("views/about_view",function(e,t,n){var r=t("./view"),i=t("./templates/about");n.exports=r.extend({id:"about-view",template:i,afterRender:function(){return this}})}),require.register("views/home_view",function(e,t,n){var r=t("./view"),i=t("./templates/home");n.exports=r.extend({id:"home-view",template:i,afterRender:function(){$("canvas").remove(),$(this.el).find("#clear").click(function(){window.localStorage.clear(),window.localStorage.clear()})}})}),require.register("views/play_view",function(e,t,n){var r=t("./view"),i=t("./templates/play"),s=t("models/question"),o=t("models/questions"),u=t("./question_view"),a=t("./questions_view");n.exports=r.extend({id:"play-view",template:i,afterRender:function(){var e=new o,t=new a({el:this.$(".questions"),collection:e});$(".questions").append(t.render().el),e.fetch(),window.saveDATA=function(){$("#entry_0").val(JSON.stringify(vertices.toJSON())),$("#entry_1").val(window.localStorage.getItem("backup")),$("#submit").trigger("click")}}})}),require.register("views/questionEditView",function(e,t,n){var r=t("./view"),i=t("./templates/question-edit");n.exports=r.extend({className:"editQuestion",template:i,initialize:function(){console.log("init questionEditView"),_.bindAll(this,"render"),this.model.bind("change",this.render)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}})}),require.register("views/question_view",function(e,t,n){var r=t("./view"),i=t("./templates/question");n.exports=r.extend({className:"question",template:i,initialize:function(){console.log("init questionView"),_.bindAll(this,"render"),this.model.bind("change",this.render)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this}})}),require.register("views/questionsEditView",function(e,t,n){var r=t("./view"),i=t("./templates/questions"),s=t("models/question"),o=t("views/questionEditView");n.exports=r.extend({className:"editQuestions",template:i,initialize:function(){console.log("init questionsEditView"),_.bindAll(this,"render"),this.collection.bind("reset",this.render)},render:function(){var e,t=this.collection;return $(this.el).html(this.template({})),e=$(this.el),t.each(function(n){var r=new o({model:n,collection:t});e.append(r.render().el)}),this}})}),require.register("views/questions_view",function(e,t,n){var r=t("./view"),i=t("./templates/questions"),s=t("models/question"),o=t("views/question_view");n.exports=r.extend({className:"questions",template:i,current:0,initialize:function(){console.log("init questionsView"),_.bindAll(this,"render"),this.collection.bind("reset",this.render)},render:function(){var e,t=this.collection;return t.comparator=function(e){return parseInt(e.get("sort"))},t.sort(),$(this.el).html(this.template({})),e=$(this.el),t.each(function(n){var r=new o({model:n,collection:t});n.get("type")!="skip"&&e.find(".questionBlock").append(r.render().el)}),$(".question .vertex").draggable({revert:"invalid",helper:"clone"}),$(".question input").each(function(e,t){window.YOU.get($(t).attr("name"))!=null&&$(t).val(window.YOU.get($(t).attr("name")))}),$(".question select").each(function(e,t){window.YOU.get($(t).attr("name"))!=null&&$(t).val(window.YOU.get($(t).attr("name")))}),$(".question input").bind("blur change",function(){window.YOU.set($(this).attr("name"),$(this).val()),window.YOU.save()}),$(".question select").bind("blur change",function(){window.YOU.set($(this).attr("name"),$(this).val()),window.YOU.save()}),$("#END").click(function(){window.saveDATA()}),this.show(0),this},events:{"click #prev":"previous","click #next":"next"},show:function(e){if(e==28||e<0){alert("end!");var t=$("input[name='5110eb6a5f68617249000005-email']").val();$.get("http://jimmytidey.co.uk/mailer.php?email_address="+t)}$($(this.el).find(".question").hide().get(e)).show(),this.collection.at(e)!=null?window.questionID=this.collection.at(e).get("_id"):window.questionID="NIL",typeof vertices!="undefined"&&vertices.reset(vertices.models)},previous:function(){this.show(--this.current)},next:function(){this.show(++this.current)}})}),require.register("views/templates/about",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<div class="masthead"><ul class="nav nav-pills pull-right"><li><a href="#">Home</a></li><li class="active"><a href="#questions">Questions</a></li><li><a href="#" class="muted">Contact</a></li></ul><h3 class="muted">Social Mirror</h3></div><hr/><h1>Questions</h1><div id="editQuestions"></div><div class="editQuestions"><div class="editQuestion"><h3><span>Title  </span></h3><p class="muted">Lorem ipsum</p><ol class="answers"><li>name</li><li>name</li><li>name</li></ol><ul class="answers delete"><li class="muted"> <em>drag here to delete</em></li></ul><ul class="new"><li> <form><input placeholder="add new"/></form></li></ul></div></div><button class="btn btn-primary disabled">Publish Questions</button><hr/><footer><p class="muted">&copy; 2012 <a href="" target="_new">Social Mirror</a>, all rights reserved.</p></footer>')}return buf.join("")}}),require.register("views/templates/home",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<div class="masthead"><ul class="nav nav-pills pull-right"><li class="active"><a href="#">Home</a></li><li><a href="#questions">Questions</a></li><li><a href="#" class="muted">Contact</a></li></ul><h3>Social Mirror</h3></div><hr/><div class="jumbotron"><!--h1 Social Mirror--><p class="lead">Social networks — who you know and are connected to — are understood to reach into all areas of life, yet very few people or organisations are capable of drawing insights from network information.</p><p>Social Mirror is a tablet application that you can use to measure, visualise, and see the potential for change in online and offline networks. Starting in January 2012, we developed a prototype for use by social science researchers.</p><p>More recently, having been approved for funding by the <a href="http://www.nominettrust.org.uk/" target="_new">Nominet Trust</a>, we are exploring its practical use in public services. We will soon be demoing the Social Mirror app on-line: <a href="http://socialmirror.org.uk/learn-more/" target="_new">please sign up here </a>if you would like to be informed when this happens.</p><div class="center"><a id="clear" href="#play" class="round btn btn-large btn-primary"><span>NEW SURVEY</span></a></div><hr/><div class="center"><a href="#play" class="btn btn-large btn-primary"><span>RESUME SURVEY</span></a></div></div><hr/><footer><p class="muted">&copy; 2012 <a href="" target="_new">Social Mirror</a>, all rights reserved.</p></footer>')}return buf.join("")}}),require.register("views/templates/index",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<div id="content"><h1>brunch</h1></div>')}return buf.join("")}}),require.register("views/templates/layout",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<!DOCTYPE html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>UI</title><link rel="stylesheet" href="/stylesheets/app.css"><script src="javascripts/vendor.js"></script><script src="javascripts/app.js"></script><script>require(\'initialize\');</script><link rel="apple-touch-icon-precomposed" sizes="144x144" href="apple-touch-icon-144x144-precomposed.png"><link rel="apple-touch-icon-precomposed" sizes="114x114" href="apple-touch-icon-114x114-precomposed.png"><link rel="apple-touch-icon-precomposed" sizes="72x72" href="apple-touch-icon-72x72-precomposed.png"><link rel="apple-touch-icon-precomposed" href="apple-touch-icon-57x57-precomposed.png"><link rel="shortcut icon" href="favicon.ico"></head><body><script>var _gaq=[[\'_setAccount\',\'UA-XXXXX-X\'],[\'_trackPageview\']];\n(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];\ng.src=(\'https:\'==location.protocol?\'//ssl\':\'//www\')+\'.google-analytics.com/ga.js\';\ns.parentNode.insertBefore(g,s)}(document,\'script\'));</script></body></html>')}return buf.join("")}}),require.register("views/templates/play",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<div class="questions"></div><div class="menu"><a id="undo" class="disabled btn pull-left"><i class="icon-undo"></i></a><a href="#" id="del" class="btn pull-right"><i class="icon-info-sign"></i></a></div><div id="you-wrapper" class="row-fluid"><div class="span6"><div id="you" class="round btn"><h1>YOU</h1></div></div></div>')}return buf.join("")}}),require.register("views/templates/question-edit",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<h3><span>Title  </span></h3><p class="muted">Lorem ipsum</p><ol class="answers"><li>name</li><li>name</li><li>name</li></ol><ul class="answers delete"><li class="muted"> <em>drag here to delete</em></li></ul><ul class="new"><li> <form><input placeholder="add new"/></form></li></ul>')}return buf.join("")}}),require.register("views/templates/question",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<div class="center"><h1><span class="muted">Q: </span><span>'+escape((interp=title)==null?"":interp)+'</span></h1><p class="muted">'+escape((interp=desc)==null?"":interp)+"</p>"),type=="graph"&&function(){if("number"==typeof answers.length)for(var e=0,t=answers.length;e<t;e++){var n=answers[e];buf.push('<div class="vertex blue"><span>');var r=n.label;buf.push(escape(null==r?"":r)),buf.push("</span></div>")}else{var t=0;for(var e in answers){t++;var n=answers[e];buf.push('<div class="vertex blue"><span>');var r=n.label;buf.push(escape(null==r?"":r)),buf.push("</span></div>")}}}.call(this),type=="text"&&function(){if("number"==typeof answers.length)for(var e=0,t=answers.length;e<t;e++){var n=answers[e];buf.push("<input"),buf.push(attrs({name:_id+"-"+n.value,placeholder:n.label},{name:!0,placeholder:!0})),buf.push("/>")}else{var t=0;for(var e in answers){t++;var n=answers[e];buf.push("<input"),buf.push(attrs({name:_id+"-"+n.value,placeholder:n.label},{name:!0,placeholder:!0})),buf.push("/>")}}}.call(this);if(type=="select"){buf.push("<select"),buf.push(attrs({name:_id},{name:!0})),buf.push('><option value="">');var __val__="please select";buf.push(escape(null==__val__?"":__val__)),buf.push("</option>"),function(){if("number"==typeof answers.length)for(var e=0,t=answers.length;e<t;e++){var n=answers[e];buf.push("<option"),buf.push(attrs({value:n.value},{value:!0})),buf.push(">");var r=n.label;buf.push(escape(null==r?"":r)),buf.push("</option>")}else{var t=0;for(var e in answers){t++;var n=answers[e];buf.push("<option"),buf.push(attrs({value:n.value},{value:!0})),buf.push(">");var r=n.label;buf.push(escape(null==r?"":r)),buf.push("</option>")}}}.call(this),buf.push("</select>")}if(type=="stars"){buf.push("<select"),buf.push(attrs({name:_id},{name:!0})),buf.push('><option value="1">');var __val__="★";buf.push(escape(null==__val__?"":__val__)),buf.push('</option><option value="2">');var __val__="★★";buf.push(escape(null==__val__?"":__val__)),buf.push('</option><option value="3">');var __val__="★★★";buf.push(escape(null==__val__?"":__val__)),buf.push('</option><option value="4">');var __val__="★★★★";buf.push(escape(null==__val__?"":__val__)),buf.push('</option><option value="5">');var __val__="★★★★★";buf.push(escape(null==__val__?"":__val__)),buf.push("</option></select>")}if(type=="10stars"){buf.push("<select"),buf.push(attrs({name:_id},{name:!0})),buf.push('><option value="1">');var __val__="★";buf.push(escape(null==__val__?"":__val__)),buf.push('</option><option value="2">');var __val__="★★";buf.push(escape(null==__val__?"":__val__)),buf.push('</option><option value="3">');var __val__="★★★";buf.push(escape(null==__val__?"":__val__)),buf.push('</option><option value="4">');var __val__="★★★★";buf.push(escape(null==__val__?"":__val__)),buf.push('</option><option value="5">');var __val__="★★★★★";buf.push(escape(null==__val__?"":__val__)),buf.push('</option><option value="6">');var __val__="★★★★★★";buf.push(escape(null==__val__?"":__val__)),buf.push('</option><option value="7">');var __val__="★★★★★★★";buf.push(escape(null==__val__?"":__val__)),buf.push('</option><option value="8">');var __val__="★★★★★★★★";buf.push(escape(null==__val__?"":__val__)),buf.push('</option><option value="9">');var __val__="★★★★★★★★★";buf.push(escape(null==__val__?"":__val__)),buf.push('</option><option value="10">');var __val__="★★★★★★★★★★";buf.push(escape(null==__val__?"":__val__)),buf.push("</option></select>")}title=="Thank you!"&&buf.push('<a id="END" class="btn">SUBMIT DATA</a>'),buf.push("</div>")}return buf.join("")}}),require.register("views/templates/questions",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push('<a id="prev" class="btn btn-large pull-left"><i class="icon-circle-arrow-left"></i></a><a id="next" class="btn btn-large pull-right"><i class="icon-circle-arrow-right"></i></a><div class="questionBlock"></div>')}return buf.join("")}}),require.register("views/templates/vertex",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{}){var interp;buf.push("<span>"+escape((interp=name)==null?"":interp)+"</span>")}return buf.join("")}}),require.register("views/templates/vertices",function(exports,require,module){module.exports=function anonymous(locals,attrs,escape,rethrow,merge){attrs=attrs||jade.attrs,escape=escape||jade.escape,rethrow=rethrow||jade.rethrow,merge=merge||jade.merge;var buf=[];with(locals||{})var interp;return buf.join("")}}),require.register("views/vertex_view",function(e,t,n){var r=t("./view"),i=t("./templates/vertex");n.exports=r.extend({className:"vertex",template:i,initialize:function(){console.log("init vertexView"),_.bindAll(this,"render"),this.model.bind("change",this.render),this.model.bind("edit",this.edit),this.model.bind("activate",this.activate),this.model.bind("deactivate",this.deactivate)},render:function(){var e=this.template(this.model.toJSON());console.log("render vertex");var t=this;return window.questionID!="51119351416b86696a000002"?$(this.el).data("model",this.model).html(e).css({top:this.model.get("y")+"px",left:this.model.get("x")+"px"}).draggable({start:function(){},drag:function(){},stop:function(){}}).hammer({prevent_default:!0,drag:!1,tap:!1}).popover({placement:"top",title:function(){return t.model.get("name")},trigger:"manual",html:!0,content:function(){var e=$("<div></div>");$('<button class="btn edit" style="display: none">Rename</button>').data("model",t.model).data("view",t).appendTo(e);var n=$('<div class="btn-group" data-toggle="buttons-radio"></div>').appendTo(e),r="",i="active";return t.model.get(window.questionID)==1&&(r="active",i=""),$('<button class="btn select0 '+i+'">Not an Answer</button>').data("model",t.model).data("view",t).appendTo(n),$('<button class="btn select1 '+r+'">An Answer</button>').data("model",t.model).data("view",t).appendTo(n),e}}):$(this.el).data("model",this.model).html(e).css({top:this.model.get("y")+"px",left:this.model.get("x")+"px"}).draggable({start:function(){},drag:function(){},stop:function(){},revert:"invalid",helper:"clone"}).hammer({prevent_default:!0,drag:!1,tap:!1}).droppable({accept:".vertex",hoverClass:"ui-state-active",drop:function(e,n){var r=n.draggable.data("model"),i=r.get("connections");i==null&&(i=[]),_.contains(i,t.model.get("id"))?(r.set("connections",_.without(i,t.model.get("id"))),r.save(),reconnectNodes(!0)):t.model.get("connections")!=null&&_.contains(t.model.get("connections"),r.get("id"))?(t.model.set("connections",_.without(t.model.get("connections"),r.get("id"))),t.model.save(),reconnectNodes(!0)):(i.push(t.model.get("id")),r.set("connections",i),r.save(),reconnectNodes(!0))}}),this.model.get(window.questionID)==1&&$(this.el).addClass("answer"),this.model.get("deleted")==1&&$(this.el).addClass("deleted"),this},events:{drag:"drag",doubletap:"menu"},answer:function(){if(window.questionID=="51119351416b86696a000002")return;$(this.el).toggleClass("answer"),$(this.el).hasClass("answer")?this.model.set(window.questionID,1,{silent:!0}):this.model.set(window.questionID,0,{silent:!0}),this.model.save(null,{silent:!0})},activate:function(e){var t=$(e.currentTarget).data("view"),n=$(e.currentTarget).data("view").model;$(t.el).addClass("answer"),n.set(window.questionID,1,{silent:!0}),n.save(null,{silent:!0})},deactivate:function(e){var t=$(e.currentTarget).data("view"),n=$(e.currentTarget).data("view").model;$(t.el).removeClass("answer"),n.set(window.questionID,0,{silent:!0}),n.save(null,{silent:!0})},select:function(){this.collection.trigger("select",this.model),$(this.el).toggleClass("selected")},drag:function(e,t){window.questionID!="51119351416b86696a000002"&&(this.model.set("x",t.position.left,{silent:!0}),this.model.set("y",t.position.top,{silent:!0}),reconnectNodes(!0)),$(this.el).popover("hide")},"delete":function(){console.log(this.model)},menu:function(){$(".vertices .vertex").not(this.el).popover("hide"),$(this.el).popover("show")},edit:function(e){console.log(e),e&&e.preventDefault();if(window.questionID=="51119351416b86696a000002")return;console.log(this),console.log($(e.currentTarget).data("view"));var t=$(e.currentTarget).data("view").model,n=$(e.currentTarget).data("view").$("span"),n=$(e.currentTarget).parents(".popover").find("h3"),r=$($(e.currentTarget).data("view").el),i=$("<input>").val(t.get("name"));n.html(i),i.bind("blur change",function(){t.set("name",$(this).val()),r.popover("hide")}).trigger("focus")}})}),require.register("views/vertices_view",function(e,t,n){var r=t("./view"),s=t("./templates/vertices"),o=t("views/vertex_view");n.exports=r.extend({className:"vertices",template:s,initialize:function(){console.log("init verticesView"),_.bindAll(this,"render"),this.collection.bind("reset",this.render),this.collection.bind("add",this.render),this.collection.bind("select",this.select)},render:function(){function r(){n=$("canvas"),n.size()==0&&(n=$("<canvas>").attr("width",$("body").width()).attr("height",$("body").height()),$("body").append(n),window.ctx=n.get(0).getContext("2d")),window.ctx.lineWidth=1}var e,t=this.collection;$(this.el).html(this.template({})),e=$(this.el),e.droppable({accept:".vertex",hoverClass:"ui-state-active",drop:function(e,n){if(n.draggable.parent().hasClass("vertices")){var r=n.draggable.data("model");r.save()}else{var r=t.create({name:n.draggable.text(),x:$(n.helper).offset().left-$(".vertices").offset().left,y:$(n.helper).offset().top-$(".vertices").offset().top});r.set("created",window.questionID),r.set(window.questionID,1),r.set("proto",r.get("name"))}t.store(),reconnectNodes()}}).hammer({prevent_default:!0}),$(".question h1").droppable({accept:".vertex",hoverClass:"ui-state-active",drop:function(e,n){if(window.questionID=="51119351416b86696a000002")return;if(n.draggable.parent().hasClass("vertices")){var r=n.draggable.data("model");r.set("deleted",1),n.draggable.addClass("deleted"),r.save(),PUB({action:"delete",id:r.get("id"),name:r.get("name")})}t.store()}}),window.questionID!="51119351416b86696a000002"?e.droppable("enable"):e.droppable("disable");var n;return r(),window.connectNodes=function(e,t){window.ctx.lineWidth=1,window.ctx.strokeStyle="rgb(255, 0, 0)",window.ctx.beginPath(),window.ctx.moveTo(e.get("x")+41,e.get("y")+41),window.ctx.lineTo(t.get("x")+41,t.get("y")+41),window.ctx.stroke(),window.ctx.closePath()},window.clearCanvas=function(){console.log("clearCanvas"),r(),window.ctx.fillStyle="rgb(255, 255, 255)",window.ctx.fillRect(0,0,parseInt(n.width()),parseInt(n.height())),window.ctx.lineWidth=.5,window.ctx.strokeStyle="rgb(128, 128, 128)",window.ctx.beginPath(),window.ctx.moveTo(0,400),window.ctx.lineTo(parseInt(n.width()),400),window.ctx.stroke(),window.ctx.closePath(),window.ctx.beginPath(),window.ctx.moveTo(0,250),window.ctx.lineTo(parseInt(n.width()),250),window.ctx.stroke(),window.ctx.closePath(),window.ctx.beginPath(),window.ctx.moveTo(0,175),window.ctx.lineTo(parseInt(n.width()),175),window.ctx.stroke(),window.ctx.closePath(),window.ctx.beginPath(),window.ctx.moveTo(0,125),window.ctx.lineTo(parseInt(n.width()),125),window.ctx.stroke(),window.ctx.closePath()},window.reconnectNodes=function(e){clearCanvas(),vertices.each(function(e){var n=e.get("connections");if(n!=null)for(i=0;i<n.length;i++)connectNodes(e,t.get(n[i]))})},t.each(function(n){var r=new o({model:n,collection:t});e.append(r.render().el)}),$("#undo").click(function(){}),reconnectNodes(!0),this},events:{"click .edit":"edit","click .popover-title":"edit2","click .select0":"deactivate","click .select1":"activate"},activate:function(e){$(e.currentTarget).data("model").trigger("activate",e)},deactivate:function(e){$(e.currentTarget).data("model").trigger("deactivate",e)},edit2:function(e){console.log("edit2"),$(e.currentTarget).parents(".popover").find(".edit").trigger("click")},edit:function(e){$(e.currentTarget).data("model").trigger("edit",e)},select:function(e){$(".vertices .selected").removeClass("selected")},swipe:function(e){console.log(e)},dragstart:function(e){},dragend:function(e){console.log(e)},drag:function(e){e.direction}})}),require.register("views/view",function(e,t,n){t("lib/view_helper"),n.exports=Backbone.View.extend({initialize:function(){this.render=_.bind(this.render,this)},template:function(){},getRenderData:function(){},render:function(){return this.$el.html(this.template(this.getRenderData())),this.afterRender(),this},afterRender:function(){}})})